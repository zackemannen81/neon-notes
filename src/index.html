<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Notes</title>
    <style>
        body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        #sidebar { width: 30%; border-right: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        #main-content { flex-grow: 1; display: flex; flex-direction: column; padding: 10px; }
        #editor { flex-grow: 1; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        #notes-list { list-style: none; padding: 0; }
        #notes-list li { padding: 5px 0; cursor: pointer; }
        #notes-list li:hover { background-color: #f0f0f0; }
        .button-group { display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Notes</h2>
        <ul id="notes-list">
            <!-- Notes will be loaded here -->
        </ul>
    </div>
    <div id="main-content">
        <textarea id="editor" placeholder="Start writing your note..."></textarea>
        <div class="button-group">
            <button id="save-button">Save Note</button>
            <span id="save-indicator" style="margin-left: 10px; font-size: 0.9em; color: #555;"></span>
            <button id="summarize-button">Summarize (Mock)</button>
        </div>
        <div id="summary-output" style="margin-top: 10px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9;">
            <!-- Summary will be displayed here -->
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const notesList = document.getElementById('notes-list');
        const saveButton = document.getElementById('save-button');
        const summarizeButton = document.getElementById('summarize-button');
        const summaryOutput = document.getElementById('summary-output');
        const saveIndicator = document.getElementById('save-indicator');

        let currentNoteId = null;
        let notes = []; // In-memory storage for now
        let autosaveTimeout;

        // Mock function to load notes
        async function loadNotes() {
            try {
                const response = await fetch('data/notes.json');
                if (response.ok) {
                    notes = await response.json();
                } else {
                    notes = [];
                }
            } catch (error) {
                console.error('Error loading notes:', error);
                notes = [];
            }
            renderNotesList();
        }

        // Mock function to save notes
        async function saveNotes() {
            saveIndicator.textContent = 'Saving...';
            console.log('Attempting to save notes:', notes);
            try {
                // Simulate sending data to a backend endpoint
                const response = await fetch('/save-notes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(notes),
                });

                if (response.ok) {
                    console.log('Notes saved (mock) successfully!');
                    saveIndicator.textContent = 'Saved';
                    setTimeout(() => saveIndicator.textContent = '', 2000); // Clear after 2 seconds
                } else {
                    console.error('Failed to save notes (mock):', response.statusText);
                    saveIndicator.textContent = 'Save Failed!';
                }
            } catch (error) {
                console.error('Error during mock save:', error);
                saveIndicator.textContent = 'Save Error!';
            }
        }

        function renderNotesList() {
            notesList.innerHTML = '';
            notes.forEach(note => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.padding = '5px 0';

                const titleSpan = document.createElement('span');
                titleSpan.textContent = note.title || 'Untitled Note';
                titleSpan.style.cursor = 'pointer';
                titleSpan.style.flexGrow = '1';
                titleSpan.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent li click event
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = titleSpan.textContent;
                    input.style.width = 'calc(100% - 30px)'; // Adjust for button
                    input.style.boxSizing = 'border-box';

                    const saveTitle = () => {
                        note.title = input.value;
                        saveNotes();
                        renderNotesList();
                    };

                    input.addEventListener('blur', saveTitle);
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            input.blur(); // Trigger blur to save
                        }
                    });

                    li.replaceChild(input, titleSpan);
                    input.focus();
                });
                li.appendChild(titleSpan);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'X';
                deleteButton.style.marginLeft = '10px';
                deleteButton.style.backgroundColor = '#f44336';
                deleteButton.style.color = 'white';
                deleteButton.style.border = 'none';
                deleteButton.style.borderRadius = '3px';
                deleteButton.style.cursor = 'pointer';
                deleteButton.style.padding = '2px 6px';
                deleteButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent li click event
                    if (confirm('Are you sure you want to delete this note?')) {
                        notes = notes.filter(n => n.id !== note.id);
                        saveNotes();
                        renderNotesList();
                        if (currentNoteId === note.id) {
                            editor.value = '';
                            currentNoteId = null;
                        }
                    }
                });

                li.appendChild(deleteButton);

                li.addEventListener('click', () => {
                    currentNoteId = note.id;
                    editor.value = note.content;
                });
                notesList.appendChild(li);
            });
        }

        saveButton.addEventListener('click', () => {
            const content = editor.value;
            if (content.trim() === '') return;

            if (currentNoteId) {
                // Update existing note
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);
                if (noteIndex > -1) {
                    notes[noteIndex].content = content;
                    notes[noteIndex].title = content.split('\n')[0].substring(0, 50); // Simple title from first line
                }
            } else {
                // Create new note
                const newNote = {
                    id: Date.now().toString(),
                    title: content.split('\n')[0].substring(0, 50), // Simple title from first line
                    content: content
                };
                notes.push(newNote);
                currentNoteId = newNote.id;
            }
            saveNotes();
            renderNotesList();
        });

        editor.addEventListener('input', () => {
            clearTimeout(autosaveTimeout);
            autosaveTimeout = setTimeout(() => {
                // Only autosave if there's a current note selected or content to create a new one
                if (currentNoteId || editor.value.trim() !== '') {
                    saveButton.click(); // Trigger the save logic
                }
            }, 3000); // Autosave every 3 seconds
        });

        summarizeButton.addEventListener('click', () => {
            const noteContent = editor.value;
            if (noteContent.trim() === '') {
                summaryOutput.textContent = 'Nothing to summarize.';
                return;
            }
            const mockSummary = `TL;DR: This is a mock summary of your note. Highlights: 1. Key point one. 2. Key point two. 3. Key point three.`;
            summaryOutput.textContent = mockSummary;
        });

        // Initial load
        loadNotes();
    </script>
</body>
</html>
